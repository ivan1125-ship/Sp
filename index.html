<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Read Aloud Checker</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Merriweather:wght@400;700&display=swap');

:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --border:#e5e7eb;
  --current:#e0e7ff;
  --accent:#4f46e5;
}
body.dark{
  --bg:#0f172a;
  --card:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --border:#334155;
  --current:#1e293b;
}

body{
  margin:0;
  padding:12px;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.top-btn{
  position:fixed;
  top:16px;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  background:var(--card);
  border:1px solid var(--border);
}
.theme-btn{right:20px}
.full-btn{right:120px}

.card{
  max-width:900px;
  margin:auto;
  background:var(--card);
  padding:24px;
  border-radius:18px;
  box-shadow:0 20px 40px rgba(0,0,0,.08);
}

h2{text-align:center}

textarea,select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:1px solid var(--border);
}
textarea{height:100px}

.buttons{
  display:flex;
  gap:12px;
  margin-top:18px;
}
button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:14px;
  cursor:pointer;
}
.load{background:#10b981;color:#fff}
.start{background:var(--accent);color:#fff}
.stop{background:#ef4444;color:#fff}
.reset{background:#64748b;color:#fff}

#text-container{
  margin-top:22px;
  height:260px;
  overflow-y:auto;
  border:1px solid var(--border);
  border-radius:16px;
  padding:22px;
  font-family:Merriweather,serif;
  font-size:20px;
}
#text span{margin:3px;padding:4px 7px;border-radius:6px}
.current{background:var(--current)}
.correct{color:#22c55e}
.almost{color:#eab308}
.wrong{color:#ef4444}

.word-chip{
  display:inline-block;
  margin:6px 6px 0 0;
  padding:6px 12px;
  background:#fee2e2;
  color:#b91c1c;
  border-radius:20px;
  cursor:pointer;
  font-weight:500;
}

#summary{
  display:none;
  margin-top:22px;
  padding:20px;
  border-radius:16px;
  border:1px solid var(--border);
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
}
.modal-box{
  background:var(--card);
  padding:26px;
  border-radius:18px;
  width:90%;
  max-width:360px;
  text-align:center;
}
</style>
</head>

<body>

<div class="top-btn theme-btn" onclick="toggleTheme()">üåô / üåû</div>
<div class="top-btn full-btn" onclick="toggleFullscreen()">üî≥ Fullscreen</div>

<div class="card">
<h2>üìñ Read Aloud Checker</h2>

<textarea id="inputText" placeholder="Paste text here..."></textarea>

<select id="languageSelect">
  <option value="en-US">English</option>
  <option value="hi-IN">Hindi</option>
</select>

<div class="buttons">
  <button class="load" onclick="loadText()">Load</button>
  <button class="start" onclick="startReading()">Start</button>
  <button class="stop" onclick="stopReading()">Stop</button>
  <button class="reset" onclick="resetAll()">Reset</button>
</div>

<div id="text-container"><p id="text"></p></div>
<div id="summary"></div>
</div>

<div id="pronounceModal" class="modal" onclick="closePronounce()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <h3 id="pronounceWord"></h3>
    <button onclick="speakWord()">üîä Pronounce</button><br><br>
    <button onclick="closePronounce()">Close</button>
  </div>
</div>

<script>
let words=[], index=0, recognition=null;
let wordResults=[], startTime;
let selectedWord="", streak=0;

const normalize=w=>w.toLowerCase().replace(/[^a-z\u0900-\u097F]/g,"");

function toggleTheme(){
  document.body.classList.toggle("dark");
}

function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
}

function loadText(){
  words=inputText.value.trim().split(/\s+/);
  index=0;
  wordResults=new Array(words.length).fill(null);
  text.innerHTML=words.map((w,i)=>`<span ${i===0?'class="current"':''}>${w}</span>`).join(" ");
  summary.style.display="none";
}

function startReading(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){
    alert("Speech recognition not supported");
    return;
  }
  recognition=new SR();
  recognition.lang=languageSelect.value;
  recognition.continuous=true;
  startTime=Date.now();

  recognition.onresult=e=>{
    e.results[e.results.length-1][0].transcript
      .split(/\s+/).forEach(processWord);
  };
  recognition.start();
}

function stopReading(){
  recognition?.stop();
}

function processWord(spoken){
  if(index>=words.length) return;
  const spans=document.querySelectorAll("#text span");
  spoken=normalize(spoken);
  const expected=normalize(words[index]);

  spans[index].classList.remove("current");

  let r="wrong";
  if(spoken===expected) r="correct";
  else if(spoken.startsWith(expected.slice(0,3))) r="almost";

  wordResults[index]=r;
  spans[index].classList.add(r);
  index++;

  if(index<spans.length) spans[index].classList.add("current");
  else showSummary();
}

function updateStreak(sec){
  if(sec>=600) streak++;
}

function showSummary(){
  const correct=wordResults.filter(r=>r==="correct").length;
  const almost=wordResults.filter(r=>r==="almost").length;
  const wrong=wordResults.filter(r=>r==="wrong").length;

  const evaluated=correct+almost+wrong;
  const accuracy=evaluated?Math.round(((correct+almost*0.5)/evaluated)*100):0;

  const sec=Math.max(1,Math.floor((Date.now()-startTime)/1000));
  const wpm=Math.round((evaluated/sec)*60);

  updateStreak(sec);

  const wrongWords=[...new Set(
    wordResults.map((r,i)=>r==="wrong"?words[i]:null).filter(Boolean)
  )];

  const misHtml=wrongWords.length
    ? wrongWords.map(w=>`<span class="word-chip" onclick="openPronounce('${w}')">${w}</span>`).join("")
    : `<span style="color:#22c55e;font-weight:600">None üéâ</span>`;

  summary.innerHTML=`
    <h3>üìä Reading Summary</h3>
    <p>‚è± Time: ${Math.floor(sec/60)}m ${sec%60}s</p>
    <p>‚ö° Speed: ${wpm} WPM</p>
    <hr>
    <p>üü¢ Correct: ${correct}</p>
    <p>üü° Almost: ${almost}</p>
    <p>üî¥ Wrong: ${wrong}</p>
    <p><strong>Accuracy: ${accuracy}%</strong></p>
    <hr>
    <p><strong>Mispronounced Words:</strong><br>${misHtml}</p>
    <hr>
    <p>üî• Reading Streak: <strong>${streak} days</strong></p>
    <p style="font-size:13px;color:var(--muted)">‚è≥ Only sessions ‚â• 10 minutes count</p>
  `;
  summary.style.display="block";
}

function openPronounce(word){
  selectedWord=word;
  pronounceWord.innerText=word;
  pronounceModal.style.display="flex";
}
function closePronounce(){
  pronounceModal.style.display="none";
}
function speakWord(){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(selectedWord);
  u.lang=languageSelect.value;
  speechSynthesis.speak(u);
}

function resetAll(){
  recognition?.stop();
  words=[];
  index=0;
  wordResults=[];
  text.innerHTML="";
  summary.style.display="none";
}
</script>

</body>
</html>
